<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>

        <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.3/themes/default/style.min.css">


    </head>

    <body>
        <h1>Test check Taxonomy ID</h1>
        <div class="w3-third w3-padding w3-card-4 w3-hover-light-blue" style="margin:2px;">
            <h3> Taxonomy ID  </h3>
            <textarea id="taxid" name="taxonid" cols="20" rows="1" style="font-family:'Courier New', Courier, monospace; resize:none; float:left; margin-right: 10px"></textarea>
            <br>
            <h3> GCF ID  </h3>
            <textarea id="gcf" name="gcfid" cols="20" rows="1" style="font-family:'Courier New', Courier, monospace; resize:none"></textarea>
            <p><input type="button" value="Check" id="check"/></p>
        </div>

        <div class="w3-row">
            <div id="loadFile_section" class="w3-half w3-padding">
                <h3> Load your fasta file ... </h3>
                <input type="file" id="genome_load" ><br>
                <button id='load-file' class="w3-btn-block w3-ripple w3-green w3-margin-top">
                     Load file to the area &rsaquo; &rsaquo; &rsaquo;
                </button><br>
            </div>

            <div id='seq_section' class="w3-half w3-padding">
                <h3> ... and view it  </h3>
                <textarea id="genome" name="sequence" cols="50" rows="3" style="font-family:'Courier New', Courier, monospace"></textarea>
                <a id='error' name='error-load'></a>
            </div>
        </div>

        <button id='next' class="w3-btn w3-ripple w3-green w3-right">Next &rsaquo;</button>

        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io.connect('http://localhost:8080')

            // To prohibit new line in textarea
            $("textarea").keydown(function(e){
              // Enter was pressed
              if (e.keyCode == 13){
                  // prevent default behavior
                  e.preventDefault();
              }
            });

            $('#load-file').click(function(){
              treatFastaFile("#genome_load")
            })

            function treatFastaFile(id_name){
            	$('a[name=error-load]').hide()
            	fastaname=$(id_name).val()
            	if(fastaname==''){
            		$('a[name=error-load]').show()
            		$('a[name=error-load]').html('No file selected')
            		return
            	} else {
            		 loadFile(id_name)
            	}
            }


            function loadFile(id){
            			if ( ! window.FileReader ){
            				return alert( 'FileReader API is not supported by your browser.' );
            			}

            			var $i = $(id), // Put file input ID here
            				input = $i[0];

            			if ( input.files && input.files[0] ){
            				file = input.files[0]; // The file
            				fr = new FileReader(); // FileReader instance

            				fr.readAsText( file );
            				fr.onload = function (){
            					// Do stuff on onload, use fr.result for contents of file
            					genome=fr.result
            					$('#genome').val(genome)
            				};
            			} else {
            				// Handle errors here
            				alert( "File not selected or browser incompatible." )
            			}
            }

            $('#check').click(function () {
                // Check if taxid is not empty
                if($('#taxid').val()==''){
                    alert('Empty taxonomy ID')
                    return false
                }
                if($('#gcf').val()==''){
                    alert('Empty GCF ID')
                    return false
                }
                // VÃ©rification pour le taxon ID, lancer un job
                socket.emit('taxid', {'taxid': $('#taxid').val(), 'gcf': $('#gcf').val()})
                socket.on('resultsTaxid', function(message) {
                  alert(message.data.slice(1,))
                  if (message.data[0] == 'Yes') {
                    window.taxonid_checked = $('#taxid').val()
                    window.gcf_checked = $('#gcf').val()
                  }
                })
            })


            $('#next').click(function () {
                // Check if a fasta file was loaded for the button next
                if($('#genome').val()==''){
                    alert('Load a fasta file')
                    return false
                }
                // Check if taxid is checked
                if(typeof taxonid_checked == 'undefined'){
                    alert('Taxonomy no checked')
                    return false
                }
                // Check if user didn't changer GCF and taxon values without checked them
                if(gcf_checked !==$('#gcf').val()){
                    alert('Be careful, the GCF ID is different from the GCF used to check the Taxonomy ID !!')
                    return false
                }
                if(taxonid_checked !== $('#taxid').val()){
                  alert('Be careful, the Taxonomy ID is different from the taxonomy ID checked !! ')
                  return false
                }
            })
        </script>
    </body>
</html>

<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- w3-css loading -->

		<title>CSTB - Crispr Search Tool for Bacteria</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!--
		<script type="text/javascript">
  			var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
		</script>
		-->

		<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">

		<!-- Code for fetching jquery and jstree online [requires internet connection]-->
		<!-- <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
		<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.1.1.js"></script> <!-- backup -->
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
			<script src="/socket.io/socket.io.js"></script>
		      <script>
		      		var socket = io.connect('http://localhost:8080')

            	socket.on('connect', function() {
									console.log('connected');
                	socket.emit('clientConnection', {data: 'I\'m connected!'});
            });

						
						function displayTreeIn(suffix){

							var to = false;
							$('#search_in'+suffix).keyup(function () {
								if(to) { clearTimeout(to); }
								to = setTimeout(function () {
									var v = $('#search_in'+suffix).val();
									$('#tree_include'+suffix).jstree().search(v);
								}, 250);
							});
							$.jstree.defaults.search.show_only_matches=true;
							// tree building

							$('#tree_include'+suffix).jstree({
								"core" : {
									'data' : { "url" : "./jsontree.json", "dataType" : "json"},
									'themes' : [
										{"dots" : true}
									],
									'animation' : false
								},
								"checkbox" : {
									"keep_selected_style" : false
								},
								"plugins" : [ "wholerow" , "checkbox" , "search" , "dnd" , "types"]
							});
							$('#tree_include'+suffix).jstree().show_dots();
						}

						function displayTreeNotIn(suffix){

							var to = false;
							$('#search_notin'+suffix).keyup(function () {
								if(to) { clearTimeout(to); }
								to = setTimeout(function () {
									var v = $('#search_notin'+suffix).val();
									$('#tree_exclude'+suffix).jstree().search(v);
								}, 250);
							});
							$.jstree.defaults.search.show_only_matches=true;
							// tree building

							$('#tree_exclude'+suffix).jstree({
								"core" : {
									'data' : { "url" : "./jsontree.json", "dataType" : "json"},
									'themes' : [
										{"dots" : true}
									],
									'animation' : false
								},
								"checkbox" : {
									"keep_selected_style" : false
								},
								"plugins" : [ "wholerow" , "checkbox" , "search" , "dnd" , "types"]
							});
							$('#tree_exclude'+suffix).jstree().show_dots();
						}


						function selectOnTreeInAG(data){
							for(m = 0, n = includeIdListAG.length; m < n; m++) {
								disabledExcAG.push(includeIdListAG[m].replace('j1','j2'));
							}
							$("#tree_exclude").jstree().enable_node(disabledExcAG);

							includeIdListAG = data.selected
							disabledExcAG = []
							for(m = 0, n = includeIdListAG.length; m < n; m++) {
								disabledExcAG.push(includeIdListAG[m].replace('j1','j2'));
								}
							$("#tree_exclude").jstree().disable_node(disabledExcAG);

							includeNameListAG = [];
							for(i = 0, j = includeIdListAG.length; i < j; i++) {
								includeNameListAG.push(data.instance.get_node(includeIdListAG[i]).text);
							};

							notSelectedIdInAG=[]
							for(i=0;i<excludeIdListAG.length;i++){
								notSelectedIdInAG.push(excludeIdListAG[i].replace('j2','j1'))
							}
							$('#tree_include').jstree(true).uncheck_node(notSelectedIdInAG);
						}

						function selectOnTreeInSG(data){
							for(m = 0, n = includeIdListSG.length; m < n; m++) {
								disabledExcSG.push(includeIdListSG[m].replace('j3','j4'));
							}
							$("#tree_exclude_sg").jstree().enable_node(disabledExcSG);

							includeIdListSG = data.selected
							disabledExcSG = []
							for(m = 0, n = includeIdListSG.length; m < n; m++) {
								disabledExcSG.push(includeIdListSG[m].replace('j3','j4'));
								}
							$("#tree_exclude_sg").jstree().disable_node(disabledExcSG);

							includeNameListSG = [];
							for(i = 0, j = includeIdListSG.length; i < j; i++) {
								includeNameListSG.push(data.instance.get_node(includeIdListSG[i]).text);
							};

							notSelectedIdInSG=[]
							for(i=0;i<excludeIdListSG.length;i++){
								notSelectedIdInSG.push(excludeIdListSG[i].replace('j4','j2'))
							}
							$('#tree_include_sg').jstree(true).uncheck_node(notSelectedIdInSG);
						}


						function selectOnTreeNotInAG(data){
							for(m = 0, n = excludeIdListAG.length; m < n; m++) {
								disabledIncAG.push(excludeIdListAG[m].replace('j2','j1'));
							}
							$("#tree_include").jstree().enable_node(disabledIncAG);
							excludeIdListAG = data.selected
							disabledIncAG = []
							for(m = 0, n = excludeIdListAG.length; m < n; m++) {
								disabledIncAG.push(excludeIdListAG[m].replace('j2','j1'));
							}
							$("#tree_include").jstree().disable_node(disabledIncAG);
							excludeNameListAG = [];
							for(i = 0, j = excludeIdListAG.length; i < j; i++) {
								excludeNameListAG.push(data.instance.get_node(excludeIdListAG[i]).text);
							};

							notSelectedIdNotInAG=[]
							for(i=0;i<includeIdListAG.length;i++){
								notSelectedIdNotInAG.push(includeIdListAG[i].replace('j1','j2'))
							}
							$('#tree_exclude').jstree(true).uncheck_node(notSelectedIdNotInAG);

						}

						function selectOnTreeNotInSG(data){
							for(m = 0, n = excludeIdListSG.length; m < n; m++) {
								disabledIncSG.push(excludeIdListSG[m].replace('j4','j3'));
							}
							$("#tree_include_sg").jstree().enable_node(disabledIncSG);
							excludeIdListSG = data.selected
							disabledIncSG = []
							for(m = 0, n = excludeIdListSG.length; m < n; m++) {
								disabledIncSG.push(excludeIdListSG[m].replace('j4','j3'));
							}
							$("#tree_include_sg").jstree().disable_node(disabledIncSG);
							excludeNameListSG = [];
							for(i = 0, j = excludeIdListSG.length; i < j; i++) {
								excludeNameListSG.push(data.instance.get_node(excludeIdListSG[i]).text);
							};

							notSelectedIdNotInSG=[]
							for(i=0;i<includeIdListSG.length;i++){
								notSelectedIdNotInSG.push(includeIdListSG[i].replace('j3','j4'))
							}
							$('#tree_exclude_sg').jstree(true).uncheck_node(notSelectedIdNotInSG);

						}

        	</script>

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.3/jstree.min.js"></script>
		<!-- <script src="./responsive.js"></script> -->

		<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.3/themes/default/style.min.css">

		<!-- modif begin -->
		<link href="https://fonts.googleapis.com/css?family=Alfa+Slab+One|Permanent+Marker" rel="stylesheet">
		<!-- modif end-->

	</head>

	<!-- BEGIN TREE -->
	<div id='tree_ag' class="w3-container w3-border w3-margin-bottom w3-padding-bottom">

		<div class="w3-half">
			<h3 class="w3-container w3-red"><i>Organisms to target</i></h3>
			<input classe="w3-input w3-margin-left w3-margin-right" style="max-width:600px" id="search_in" type="text" value="" placeholder="Search for an organism" />
			<div id="wrap">
				<div id="tree_include" class="w3-container w3-hover-pale-red">
				</div>
			</div>
		</div>

		<div class="w3-half">
			<h3 class="w3-container w3-green"><i>Organisms to exclude</i></h3>
			<input classe="w3-input w3-margin-left w3-margin-right" style="max-width:600px" id="search_notin" type="text" value="" placeholder="Search for an organism" />
			<div id="wrap">
				<div id="tree_exclude" class="w3-container w3-hover-pale-green">
				<!-- Here will display the tree -->
				</div>
			</div>
		</div>
		<button id="submit_trees" class="w3-btn w3-ripple w3-green w3-right"><b>Submit selections</b></button>
		<button id="reset_trees" class="w3-btn w3-ripple w3-red w3-left">Reset trees</button>
	</div>
	<!-- END TREE -->
